{"version":3,"file":"SimpleMapSettings.min.js","sources":["../../resources/js/Helpers.js","../../resources/js/SimpleMapSettings.js"],"sourcesContent":["/* globals google */\n\n/**\n * Load the google API into the dom\n *\n * @param {string} key - Google Maps API key\n * @param {string} locale - The locale\n * @static\n */\nexport const loadGoogleAPI = function (key, locale) {\n\twindow.simpleMapsLoadingGoogle = true;\n\t\n\tconst gmjs = document.createElement(\"script\");\n\tgmjs.type = \"text/javascript\";\n\tgmjs.src = \"https://www.google.com/jsapi?key=\" + key;\n\tgmjs.onreadystatechange = function () {\n\t\tloadMapsApi(key, locale);\n\t};\n\tgmjs.onload = function () {\n\t\tloadMapsApi(key, locale);\n\t};\n\tdocument.body.appendChild(gmjs);\n};\n\n/**\n * Load the google maps API into the dom\n *\n * @param {string} key - Google Maps API key\n * @param {string} locale - The locale\n * @static\n */\nexport const loadMapsApi = function (key, locale) {\n\tgoogle.load(\"maps\", \"3\", {\n\t\tother_params: [\n\t\t\t\"libraries=places\",\n\t\t\t`key=${key}`,\n\t\t\t`language=${locale.replace(\"_\", \"-\")}`,\n\t\t\t`region=${locale}`,\n\t\t].join(\"&\"),\n\t\tcallback: function () {\n\t\t\tdocument.dispatchEvent(new Event(\"SimpleMapsGAPILoaded\"));\n\t\t}\n\t});\n};","/* globals google, $ */\n\nimport { loadGoogleAPI, loadMapsApi } from \"./Helpers\";\n\nclass SimpleMapSettings {\n\t\n\t// Variables\n\t// =========================================================================\n\t\n\tnamespacedId = null;\n\tmapSettings = {\n\t\tlat: 51.272154,\n\t\tlng: 0.514951,\n\t\tzoom: 15,\n\t\theight: 400,\n\t\tboundary: {\n\t\t\tnw: { lat: 0, lng: 0 },\n\t\t\tse: { lat: 0, lng: 0 },\n\t\t}\n\t};\n\t\n\tsetup = false;\n\tinputs = null;\n\t\n\tsettingsMap = null;\n\tsettingsMapEl = null;\n\tsettingsMapWrap = null;\n\t\n\tboundaryMap = null;\n\t\n\tmouseMoveLastPos = 0;\n\tnextHeight = 0;\n\t\n\t// SimpleMapSettings\n\t// =========================================================================\n\t\n\tconstructor (key, locale, namespacedId, mapSettings) {\n\t\tthis.namespacedId = namespacedId;\n\t\tthis.mapSettings = Object.keys(mapSettings).reduce((a, b) => {\n\t\t\ta[b] = +mapSettings[b];\n\t\t\treturn a;\n\t\t}, {});\n\t\t\n\t\tthis.inputs = {\n\t\t\tlat: document.getElementById(`${this.namespacedId}lat`),\n\t\t\tlng: document.getElementById(`${this.namespacedId}lng`),\n\t\t\tzoom: document.getElementById(`${this.namespacedId}zoom`),\n\t\t\theight: document.getElementById(`${this.namespacedId}height`),\n\t\t};\n\t\t\n\t\t// Load Google APIs if they aren\"t already\n\t\tif (typeof google === \"undefined\") {\n\t\t\tif (!window.simpleMapsLoadingGoogle)\n\t\t\t\tloadGoogleAPI(key, locale);\n\t\t} else if (!google.maps || !google.maps.places) {\n\t\t\t// Load Google Maps APIs if the aren\"t already\n\t\t\tif (!window.simpleMapsLoadingGoogle)\n\t\t\t\tloadMapsApi(key, locale);\n\t\t} else {\n\t\t\tif (!this.setup)\n\t\t\t\tthis.setupMaps();\n\t\t}\n\t\t\n\t\tdocument.addEventListener(\"SimpleMapsGAPILoaded\", () => {\n\t\t\tif (!this.setup)\n\t\t\t\tthis.setupMaps();\n\t\t});\n\t\t\n\t\t// Re-draw the maps when the type select changes\n\t\t// (otherwise the maps will be grey)\n\t\tdocument.getElementById(\"type\").addEventListener(\"change\", e => {\n\t\t\tif (e.target.value === \"ether\\\\simplemap\\\\fields\\\\MapField\")\n\t\t\t\tthis.redrawMaps();\n\t\t});\n\t\t\n\t\t$(`#${this.namespacedId}hideMap`).on(\"change\", this.onHideMapToggle);\n\t}\n\t\n\t// Events\n\t// =========================================================================\n\t\n\t// Events: Settings Map\n\t// -------------------------------------------------------------------------\n\t\n\tonHideMapToggle = e => {\n\t\tconst shouldHide = !!e.target.getElementsByTagName(\"input\")[0].value;\n\t\t\n\t\tif (shouldHide) {\n\t\t\tconst nextMaxHeight =\n\t\t\t\tthis.settingsMapWrap.getBoundingClientRect().height + \"px\";\n\t\t\t\n\t\t\tif (nextMaxHeight !== 0)\n\t\t\t\tthis.settingsMapWrap.style.maxHeight = nextMaxHeight;\n\t\t}\n\t\t\n\t\tsetTimeout(() => {\n\t\t\tthis.settingsMapWrap\n\t\t\t\t.classList[shouldHide ? \"add\" : \"remove\"](\"hide\");\n\t\t}, 1);\n\t};\n\t\n\tonSettingsMapReposition = () => {\n\t\tthis.inputs.lng.value = this.settingsMap.center.lng();\n\t\tthis.inputs.lat.value = this.settingsMap.center.lat();\n\t};\n\t\n\tonSettingsMapZoom = () => {\n\t\tthis.inputs.zoom.value = this.settingsMap.getZoom();\n\t};\n\t\n\tonResizeMouseDown = e => {\n\t\te.preventDefault();\n\t\t\n\t\tthis.mouseMoveLastPos = e.clientY;\n\t\tthis.nextHeight = this.mapSettings.height;\n\t\t\n\t\tthis.settingsMapEl.style.pointerEvents = \"none\";\n\t\tthis.settingsMapWrap.style.maxHeight = '';\n\t\t\n\t\tdocument.addEventListener(\"mousemove\", this.onResizeMouseMove);\n\t\tdocument.addEventListener(\"mouseup\", this.onResizeMouseUp);\n\t};\n\t\n\tonResizeMouseMove = e => {\n\t\tthis.nextHeight = this.nextHeight + (e.clientY - this.mouseMoveLastPos);\n\t\tthis.mouseMoveLastPos = e.clientY;\n\t\t\n\t\tif (this.nextHeight < 250)\n\t\t\treturn;\n\t\t\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.mapSettings.height = this.nextHeight;\n\t\t\tthis.inputs.height.value = this.nextHeight;\n\t\t\tthis.settingsMapEl.style.height = `${this.nextHeight}px`;\n\t\t\t\n\t\t\tconst c = this.settingsMap.getCenter();\n\t\t\t\n\t\t\tgoogle.maps.event.trigger(this.settingsMap, \"resize\");\n\t\t\tthis.settingsMap.setCenter(c);\n\t\t});\n\t};\n\t\n\tonResizeMouseUp = () => {\n\t\tthis.settingsMapEl.style.pointerEvents = \"\";\n\t\tdocument.removeEventListener(\"mousemove\", this.onResizeMouseMove);\n\t\tdocument.removeEventListener(\"mouseup\", this.onResizeMouseUp);\n\t};\n\t\n\t// Actions\n\t// =========================================================================\n\t\n\tsetupMaps () {\n\t\t\n\t\tthis.setup = true;\n\t\t\n\t\t// Settings Map\n\t\t// ---------------------------------------------------------------------\n\t\t\n\t\tthis.settingsMapEl =\n\t\t\tdocument.getElementById(`${this.namespacedId}settingsMap`);\n\t\tthis.settingsMapWrap =\n\t\t\tdocument.getElementById(`${this.namespacedId}settingsMapWrap`);\n\t\t\n\t\tthis.settingsMap = new google.maps.Map(this.settingsMapEl, {\n\t\t\tzoom: this.mapSettings.zoom,\n\t\t\tcenter: new google.maps.LatLng(\n\t\t\t\tthis.mapSettings.lat,\n\t\t\t\tthis.mapSettings.lng\n\t\t\t),\n\t\t\tscrollwheel: false,\n\t\t\tfullscreenControl: false,\n\t\t\tmapTypeControl: false,\n\t\t\tstreetViewControl: false,\n\t\t\trotateControl: false,\n\t\t\tmapTypeId: google.maps.MapTypeId.ROADMAP,\n\t\t});\n\t\t\n\t\tgoogle.maps.event.addListener(\n\t\t\tthis.settingsMap,\n\t\t\t'dragend',\n\t\t\tthis.onSettingsMapReposition\n\t\t);\n\t\t\n\t\tgoogle.maps.event.addListener(\n\t\t\tthis.settingsMap,\n\t\t\t'zoom_changed',\n\t\t\tthis.onSettingsMapZoom\n\t\t);\n\t\t\n\t\t// Resizer\n\t\tdocument.getElementById(`${this.namespacedId}settingsMapHeight`)\n\t\t        .addEventListener(\"mousedown\", this.onResizeMouseDown);\n\t\t\n\t\t// Boundary Map\n\t\t// ---------------------------------------------------------------------\n\t\t\n\t\tconst boundaryMapEl =\n\t\t\tdocument.getElementById(`${this.namespacedId}boundaryMap`);\n\t\t\n\t\t// TODO: If we have boundaries, position the map to contain them.\n\t\t// TODO: Add [Clear] button\n\t\t\n\t\tthis.boundaryMap = new google.maps.Map(boundaryMapEl, {\n\t\t\tzoom: this.mapSettings.zoom,\n\t\t\tcenter: new google.maps.LatLng(\n\t\t\t\tthis.mapSettings.lat,\n\t\t\t\tthis.mapSettings.lng\n\t\t\t),\n\t\t\tscrollwheel: false,\n\t\t\tfullscreenControl: false,\n\t\t\tmapTypeControl: false,\n\t\t\tstreetViewControl: false,\n\t\t\trotateControl: false,\n\t\t\tmapTypeId: google.maps.MapTypeId.ROADMAP,\n\t\t});\n\t\t\n\t}\n\t\n\tredrawMaps () {\n\t\tconst xa = this.settingsMap.getZoom()\n\t\t\t, ca = this.settingsMap.getCenter()\n\t\t\t, xb = this.boundaryMap.getZoom()\n\t\t\t, cb = this.boundaryMap.getCenter();\n\t\t\n\t\tsetTimeout(() => {\n\t\t\tgoogle.maps.event.trigger(this.settingsMap, 'resize');\n\t\t\tthis.settingsMap.setZoom(xa);\n\t\t\tthis.settingsMap.setCenter(ca);\n\t\t\t\n\t\t\tgoogle.maps.event.trigger(this.boundaryMap, 'resize');\n\t\t\tthis.boundaryMap.setZoom(xb);\n\t\t\tthis.boundaryMap.setCenter(cb);\n\t\t}, 1);\n\t}\n\t\n}\n\nwindow.SimpleMapSettings = SimpleMapSettings;"],"names":["loadGoogleAPI","key","locale","simpleMapsLoadingGoogle","gmjs","document","createElement","type","src","onreadystatechange","onload","body","appendChild","loadMapsApi","load","replace","join","dispatchEvent","Event","SimpleMapSettings","namespacedId","mapSettings","lat","lng","setup","inputs","settingsMap","settingsMapEl","settingsMapWrap","boundaryMap","mouseMoveLastPos","nextHeight","onHideMapToggle","shouldHide","e","target","getElementsByTagName","value","nextMaxHeight","_this","getBoundingClientRect","height","style","maxHeight","classList","onSettingsMapReposition","center","onSettingsMapZoom","zoom","getZoom","onResizeMouseDown","preventDefault","clientY","pointerEvents","addEventListener","onResizeMouseMove","onResizeMouseUp","c","getCenter","maps","event","trigger","setCenter","removeEventListener","Object","keys","reduce","a","b","getElementById","this","google","window","places","setupMaps","redrawMaps","on","Map","LatLng","MapTypeId","ROADMAP","addListener","boundaryMapEl","xa","ca","xb","cb","_this2","setZoom"],"mappings":"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"}